<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…³é”®è¯æ’åç›‘æ§ - 24å°æ—¶è‡ªåŠ¨åŒ–ç³»ç»Ÿ</title>
    <meta name="description" content="æ™ºèƒ½å…³é”®è¯æ’åç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶è·Ÿè¸ªæœç´¢å¼•æ“æ’åå˜åŒ–ï¼Œæä¾›ä¼˜åŒ–å»ºè®®">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .metric-value.excellent { color: #28a745; }
        .metric-value.good { color: #17a2b8; }
        .metric-value.fair { color: #ffc107; }
        .metric-value.poor { color: #dc3545; }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .metric-trend {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            margin-top: 0.5rem;
        }
        
        .trend-up { background: #d4edda; color: #155724; }
        .trend-down { background: #f8d7da; color: #721c24; }
        .trend-stable { background: #e2e3e5; color: #383d41; }
        
        .rankings-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        
        .rankings-table th,
        .rankings-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .rankings-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .rankings-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .rank-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
        
        .rank-1-3 { background: #d4edda; color: #155724; }
        .rank-4-10 { background: #cce5ff; color: #004085; }
        .rank-11-20 { background: #fff3cd; color: #856404; }
        .rank-21-50 { background: #f8d7da; color: #721c24; }
        .rank-none { background: #e2e3e5; color: #383d41; }
        
        .keyword-score {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .score-high { background: #28a745; color: white; }
        .score-medium { background: #ffc107; color: #212529; }
        .score-low { background: #6c757d; color: white; }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }
        
        .opportunity-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }
        
        .opportunity-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .opportunity-urgent { border-left: 4px solid #dc3545; }
        .opportunity-high { border-left: 4px solid #ffc107; }
        .opportunity-medium { border-left: 4px solid #17a2b8; }
        
        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .filter-tab {
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .filter-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .filter-tab:hover:not(.active) {
            background: #f8f9fa;
        }
        
        .search-box {
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            margin: 1rem 0;
            font-size: 1rem;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .loading.show { display: block; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .status-collecting { background: #17a2b8; }
        .status-monitoring { background: #28a745; }
        .status-analyzing { background: #ffc107; }
        .status-error { background: #dc3545; }
        
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .rankings-table {
                font-size: 0.8rem;
            }
            
            .rankings-table th,
            .rankings-table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.6 0 12 0zm5.6 8.2l-1.9 9c-.1.6-.6.7-1.2.4l-3.3-2.4-1.6 1.5c-.2.2-.3.3-.6.3l.2-3.3L16.8 7c.3-.2-.1-.4-.4-.2L8.1 12l-3.2-1c-.7-.2-.7-.7.1-.9l12.4-4.8c.6-.2 1.1.1.9 1z"/>
                </svg>
                <h1><a href="index.html" style="color: inherit; text-decoration: none;">Telegram å¯¼èˆªç«™</a></h1>
            </div>
            <div style="color: white; font-size: 0.9rem;">
                <span class="status-indicator status-monitoring"></span>
                å…³é”®è¯æ’åç›‘æ§ç³»ç»Ÿ
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <section class="hero">
                <h2>ğŸ“Š å…³é”®è¯æ’åç›‘æ§ä¸­å¿ƒ</h2>
                <p>24å°æ—¶è‡ªåŠ¨é‡‡é›†å…³é”®è¯ï¼Œå®æ—¶ç›‘æ§æœç´¢å¼•æ“æ’åå˜åŒ–</p>
            </section>

            <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
            <div class="dashboard">
                <h3>ğŸ¯ æ ¸å¿ƒæ’åæŒ‡æ ‡</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">ç›‘æ§å…³é”®è¯</div>
                        <div class="metric-value excellent" id="totalKeywords">0</div>
                        <div class="metric-trend trend-up" id="keywordsTrend">+0 ä»Šæ—¥æ–°å¢</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">å¹³å‡æ’å</div>
                        <div class="metric-value good" id="avgRanking">0</div>
                        <div class="metric-trend trend-stable" id="avgRankingTrend">æ— å˜åŒ–</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">å‰10æ’å</div>
                        <div class="metric-value excellent" id="top10Rankings">0</div>
                        <div class="metric-trend trend-up" id="top10Trend">+0 æœ¬å‘¨</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">é¦–é¡µæ’å</div>
                        <div class="metric-value good" id="firstPageRankings">0</div>
                        <div class="metric-trend trend-up" id="firstPageTrend">+0 æœ¬å‘¨</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">ä¼˜åŒ–æœºä¼š</div>
                        <div class="metric-value fair" id="opportunities">0</div>
                        <div class="metric-trend trend-stable" id="opportunitiesTrend">å¾…ä¼˜åŒ–</div>
                    </div>
                </div>
            </div>

            <!-- æ’åè¶‹åŠ¿å›¾ -->
            <div class="dashboard">
                <h3>ğŸ“ˆ æ’åè¶‹åŠ¿åˆ†æ</h3>
                <div class="chart-container">
                    <canvas id="rankingTrendChart"></canvas>
                </div>
            </div>

            <!-- æœç´¢å¼•æ“åˆ†å¸ƒ -->
            <div class="dashboard">
                <h3>ğŸ” æœç´¢å¼•æ“æ’ååˆ†å¸ƒ</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="engineDistChart"></canvas>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="rankingDistChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿæ§åˆ¶ -->
            <div class="dashboard">
                <h3>ğŸ›ï¸ ç³»ç»Ÿæ§åˆ¶</h3>
                <div class="action-buttons">
                    <button class="action-btn btn-primary" onclick="startKeywordCollection()">
                        ğŸš€ å¯åŠ¨å…³é”®è¯é‡‡é›†
                    </button>
                    
                    <button class="action-btn btn-success" onclick="startRankingMonitor()">
                        ğŸ“Š å¼€å§‹æ’åç›‘æ§
                    </button>
                    
                    <button class="action-btn btn-warning" onclick="analyzeKeywords()">
                        ğŸ§  æ™ºèƒ½åˆ†æ
                    </button>
                    
                    <a href="24h-system-dashboard.html" class="action-btn btn-primary">
                        âš¡ ç³»ç»Ÿæ€»æ§åˆ¶å°
                    </a>
                </div>
            </div>

            <!-- å…³é”®è¯æ’åè¡¨ -->
            <div class="dashboard">
                <h3>ğŸ“‹ å…³é”®è¯æ’åè¯¦æƒ…</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <input type="text" class="search-box" id="keywordSearch" placeholder="æœç´¢å…³é”®è¯...">
                    
                    <div class="filter-tabs">
                        <div class="filter-tab active" data-filter="all">å…¨éƒ¨</div>
                        <div class="filter-tab" data-filter="top10">å‰10å</div>
                        <div class="filter-tab" data-filter="firstPage">é¦–é¡µ</div>
                        <div class="filter-tab" data-filter="opportunities">æœºä¼š</div>
                        <div class="filter-tab" data-filter="noRank">æ— æ’å</div>
                    </div>
                </div>
                
                <div class="loading" id="tableLoading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è½½æ’åæ•°æ®...</p>
                </div>
                
                <table class="rankings-table" id="rankingsTable">
                    <thead>
                        <tr>
                            <th>å…³é”®è¯</th>
                            <th>åˆ†ç±»</th>
                            <th>å¾—åˆ†</th>
                            <th>ç™¾åº¦</th>
                            <th>Google</th>
                            <th>Bing</th>
                            <th>360</th>
                            <th>æœ€ä½³æ’å</th>
                            <th>è¶‹åŠ¿</th>
                            <th>æœºä¼š</th>
                        </tr>
                    </thead>
                    <tbody id="rankingsTableBody">
                        <!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ -->
                    </tbody>
                </table>
            </div>

            <!-- ä¼˜åŒ–æœºä¼š -->
            <div class="dashboard">
                <h3>ğŸ¯ ä¼˜åŒ–æœºä¼šè¯†åˆ«</h3>
                
                <div class="filter-tabs">
                    <div class="filter-tab active" data-priority="all">å…¨éƒ¨æœºä¼š</div>
                    <div class="filter-tab" data-priority="urgent">ç´§æ€¥</div>
                    <div class="filter-tab" data-priority="high">é«˜ä¼˜å…ˆçº§</div>
                    <div class="filter-tab" data-priority="medium">ä¸­ä¼˜å…ˆçº§</div>
                </div>
                
                <div id="opportunitiesContainer">
                    <!-- åŠ¨æ€ç”Ÿæˆæœºä¼šå¡ç‰‡ -->
                </div>
            </div>

            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="dashboard">
                <h3>âš™ï¸ ç³»ç»Ÿè¿è¡ŒçŠ¶æ€</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div class="metric-card">
                        <div class="metric-label">
                            <span class="status-indicator status-collecting"></span>
                            å…³é”®è¯é‡‡é›†
                        </div>
                        <div class="metric-value" id="collectionStatus">è¿è¡Œä¸­</div>
                        <div class="metric-trend" id="lastCollection">2åˆ†é’Ÿå‰</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">
                            <span class="status-indicator status-monitoring"></span>
                            æ’åç›‘æ§
                        </div>
                        <div class="metric-value" id="monitoringStatus">æ­£å¸¸</div>
                        <div class="metric-trend" id="lastMonitoring">15åˆ†é’Ÿå‰</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">
                            <span class="status-indicator status-analyzing"></span>
                            æ™ºèƒ½åˆ†æ
                        </div>
                        <div class="metric-value" id="analysisStatus">å·²å®Œæˆ</div>
                        <div class="metric-trend" id="lastAnalysis">1å°æ—¶å‰</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Telegram å¯¼èˆªç«™. 24å°æ—¶å…³é”®è¯æ’åç›‘æ§ç³»ç»Ÿ</p>
            <div class="footer-links">
                <a href="index.html">è¿”å›é¦–é¡µ</a>
                <a href="24h-system-dashboard.html">ç³»ç»Ÿæ§åˆ¶å°</a>
                <a href="batch-index-monitor.html">æ‰¹é‡ç›‘æ§</a>
            </div>
        </div>
    </footer>

    <script>
        // å…¨å±€æ•°æ®
        let keywordData = [];
        let rankingData = [];
        let opportunityData = [];
        let charts = {};
        
        // æ¨¡æ‹Ÿæ•°æ®
        const mockKeywords = [
            { keyword: 'Telegram', category: 'brand', score: 9.5, rankings: { baidu: 2, google: 1, bing: 3, so360: 4 }, trend: 'up', opportunities: 1 },
            { keyword: 'Telegram Bot', category: 'product', score: 8.7, rankings: { baidu: 5, google: 3, bing: 7, so360: 6 }, trend: 'up', opportunities: 2 },
            { keyword: 'ç”µæŠ¥æœºå™¨äºº', category: 'product', score: 8.2, rankings: { baidu: 3, google: 12, bing: 8, so360: 5 }, trend: 'stable', opportunities: 1 },
            { keyword: 'Telegramé¢‘é“', category: 'product', score: 7.9, rankings: { baidu: 8, google: 6, bing: 11, so360: 9 }, trend: 'up', opportunities: 2 },
            { keyword: 'TGå¯¼èˆª', category: 'brand', score: 7.5, rankings: { baidu: 12, google: 15, bing: 18, so360: 14 }, trend: 'down', opportunities: 3 },
            { keyword: 'Telegramä¸‹è½½', category: 'feature', score: 7.2, rankings: { baidu: 15, google: 8, bing: 12, so360: 16 }, trend: 'up', opportunities: 1 },
            { keyword: 'ç”µæŠ¥ç¾¤ç»„', category: 'product', score: 6.8, rankings: { baidu: 18, google: 22, bing: 15, so360: 19 }, trend: 'stable', opportunities: 2 },
            { keyword: 'Telegramæ•™ç¨‹', category: 'tutorial', score: 6.5, rankings: { baidu: 25, google: 18, bing: 28, so360: 22 }, trend: 'up', opportunities: 1 },
            { keyword: 'TGæœºå™¨äººå¼€å‘', category: 'tutorial', score: 6.2, rankings: { baidu: null, google: 35, bing: null, so360: 45 }, trend: 'stable', opportunities: 3 },
            { keyword: 'Telegram API', category: 'feature', score: 5.8, rankings: { baidu: null, google: 28, bing: 32, so360: null }, trend: 'up', opportunities: 2 }
        ];

        const mockOpportunities = [
            { keyword: 'TGå¯¼èˆª', type: 'breakthrough_potential', priority: 'high', description: 'åœ¨ç™¾åº¦æ¥è¿‘é¦–é¡µï¼Œå½“å‰ç¬¬12ä½', actions: ['ä¼˜åŒ–é¡µé¢å†…å®¹', 'å¢åŠ ç›¸å…³å†…é“¾'] },
            { keyword: 'Telegramä¸‹è½½', type: 'first_page', priority: 'medium', description: 'åœ¨Googleè¡¨ç°è‰¯å¥½ï¼Œå¯ä¼˜åŒ–å…¶ä»–å¼•æ“', actions: ['è·¨å¼•æ“ä¼˜åŒ–', 'æå‡é¡µé¢è´¨é‡'] },
            { keyword: 'TGæœºå™¨äººå¼€å‘', type: 'new_opportunity', priority: 'high', description: 'é«˜ä»·å€¼å…³é”®è¯å°šæœªå……åˆ†ä¼˜åŒ–', actions: ['åˆ›å»ºä¸“é—¨å†…å®¹', 'å»ºç«‹å†…é“¾ç»“æ„'] }
        ];

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            loadMockData();
            initializeCharts();
            updateMetrics();
            generateRankingsTable();
            generateOpportunities();
            bindEvents();
            
            // å®šæœŸæ›´æ–°æ•°æ®
            setInterval(updateRealTimeData, 30000);
        });

        // åŠ è½½æ¨¡æ‹Ÿæ•°æ®
        function loadMockData() {
            keywordData = mockKeywords;
            opportunityData = mockOpportunities;
            
            console.log('ğŸ“Š å·²åŠ è½½å…³é”®è¯æ•°æ®:', keywordData.length);
            console.log('ğŸ¯ å·²åŠ è½½æœºä¼šæ•°æ®:', opportunityData.length);
        }

        // æ›´æ–°æ ¸å¿ƒæŒ‡æ ‡
        function updateMetrics() {
            const totalKeywords = keywordData.length;
            const avgRanking = calculateAverageRanking();
            const top10Count = countRankingsByRange(1, 10);
            const firstPageCount = countRankingsByRange(1, 20);
            const opportunitiesCount = opportunityData.length;
            
            document.getElementById('totalKeywords').textContent = totalKeywords;
            document.getElementById('avgRanking').textContent = avgRanking.toFixed(1);
            document.getElementById('top10Rankings').textContent = top10Count;
            document.getElementById('firstPageRankings').textContent = firstPageCount;
            document.getElementById('opportunities').textContent = opportunitiesCount;
            
            // æ›´æ–°è¶‹åŠ¿
            document.getElementById('keywordsTrend').textContent = `+${Math.floor(Math.random() * 10)} ä»Šæ—¥æ–°å¢`;
            document.getElementById('top10Trend').textContent = `+${Math.floor(Math.random() * 5)} æœ¬å‘¨`;
            document.getElementById('firstPageTrend').textContent = `+${Math.floor(Math.random() * 8)} æœ¬å‘¨`;
        }

        // è®¡ç®—å¹³å‡æ’å
        function calculateAverageRanking() {
            let totalRank = 0;
            let count = 0;
            
            keywordData.forEach(item => {
                Object.values(item.rankings).forEach(rank => {
                    if (rank && rank > 0) {
                        totalRank += rank;
                        count++;
                    }
                });
            });
            
            return count > 0 ? totalRank / count : 0;
        }

        // ç»Ÿè®¡æ’åèŒƒå›´å†…çš„æ•°é‡
        function countRankingsByRange(min, max) {
            let count = 0;
            
            keywordData.forEach(item => {
                Object.values(item.rankings).forEach(rank => {
                    if (rank && rank >= min && rank <= max) {
                        count++;
                    }
                });
            });
            
            return count;
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            initRankingTrendChart();
            initEngineDistChart();
            initRankingDistChart();
        }

        // æ’åè¶‹åŠ¿å›¾
        function initRankingTrendChart() {
            const ctx = document.getElementById('rankingTrendChart').getContext('2d');
            
            // ç”Ÿæˆæ¨¡æ‹Ÿè¶‹åŠ¿æ•°æ®
            const days = 30;
            const dates = [];
            const avgRankings = [];
            const top10Counts = [];
            
            for (let i = days; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));
                
                avgRankings.push(15 + Math.random() * 10 - i * 0.1);
                top10Counts.push(Math.floor(10 + Math.random() * 15 + i * 0.2));
            }
            
            charts.rankingTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'å¹³å‡æ’å',
                        data: avgRankings,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'å‰10æ’åæ•°é‡',
                        data: top10Counts,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'å¹³å‡æ’å'
                            },
                            reverse: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'å‰10æ’åæ•°é‡'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // æœç´¢å¼•æ“åˆ†å¸ƒå›¾
        function initEngineDistChart() {
            const ctx = document.getElementById('engineDistChart').getContext('2d');
            
            const engineStats = calculateEngineStats();
            
            charts.engineDist = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ç™¾åº¦', 'Google', 'Bing', '360æœç´¢'],
                    datasets: [{
                        data: [
                            engineStats.baidu,
                            engineStats.google,
                            engineStats.bing,
                            engineStats.so360
                        ],
                        backgroundColor: [
                            '#dc3545',
                            '#17a2b8',
                            '#ffc107',
                            '#28a745'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'æœç´¢å¼•æ“æ’ååˆ†å¸ƒ'
                        }
                    }
                }
            });
        }

        // æ’ååˆ†å¸ƒå›¾
        function initRankingDistChart() {
            const ctx = document.getElementById('rankingDistChart').getContext('2d');
            
            const rankingDist = calculateRankingDistribution();
            
            charts.rankingDist = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['å‰3å', '4-10å', '11-20å', '21-50å', '50åä»¥å'],
                    datasets: [{
                        label: 'å…³é”®è¯æ•°é‡',
                        data: [
                            rankingDist.top3,
                            rankingDist.top10,
                            rankingDist.top20,
                            rankingDist.top50,
                            rankingDist.beyond50
                        ],
                        backgroundColor: [
                            '#28a745',
                            '#17a2b8',
                            '#ffc107',
                            '#fd7e14',
                            '#dc3545'
                        ],
                        borderColor: [
                            '#28a745',
                            '#17a2b8',
                            '#ffc107',
                            '#fd7e14',
                            '#dc3545'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'æ’ååŒºé—´åˆ†å¸ƒ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å…³é”®è¯æ•°é‡'
                            }
                        }
                    }
                }
            });
        }

        // è®¡ç®—æœç´¢å¼•æ“ç»Ÿè®¡
        function calculateEngineStats() {
            const stats = { baidu: 0, google: 0, bing: 0, so360: 0 };
            
            keywordData.forEach(item => {
                if (item.rankings.baidu) stats.baidu++;
                if (item.rankings.google) stats.google++;
                if (item.rankings.bing) stats.bing++;
                if (item.rankings.so360) stats.so360++;
            });
            
            return stats;
        }

        // è®¡ç®—æ’ååˆ†å¸ƒ
        function calculateRankingDistribution() {
            const dist = { top3: 0, top10: 0, top20: 0, top50: 0, beyond50: 0 };
            
            keywordData.forEach(item => {
                Object.values(item.rankings).forEach(rank => {
                    if (rank) {
                        if (rank <= 3) dist.top3++;
                        else if (rank <= 10) dist.top10++;
                        else if (rank <= 20) dist.top20++;
                        else if (rank <= 50) dist.top50++;
                        else dist.beyond50++;
                    }
                });
            });
            
            return dist;
        }

        // ç”Ÿæˆæ’åè¡¨æ ¼
        function generateRankingsTable() {
            const tbody = document.getElementById('rankingsTableBody');
            tbody.innerHTML = '';
            
            keywordData.forEach(item => {
                const row = document.createElement('tr');
                
                const bestRank = getBestRank(item.rankings);
                const trendIcon = getTrendIcon(item.trend);
                const scoreClass = getScoreClass(item.score);
                
                row.innerHTML = `
                    <td><strong>${item.keyword}</strong></td>
                    <td><span class="badge">${getCategoryName(item.category)}</span></td>
                    <td><span class="keyword-score ${scoreClass}">${item.score}</span></td>
                    <td>${getRankBadge(item.rankings.baidu)}</td>
                    <td>${getRankBadge(item.rankings.google)}</td>
                    <td>${getRankBadge(item.rankings.bing)}</td>
                    <td>${getRankBadge(item.rankings.so360)}</td>
                    <td>${getRankBadge(bestRank)}</td>
                    <td>${trendIcon}</td>
                    <td><span class="badge">${item.opportunities} ä¸ªæœºä¼š</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // è·å–æœ€ä½³æ’å
        function getBestRank(rankings) {
            const ranks = Object.values(rankings).filter(r => r && r > 0);
            return ranks.length > 0 ? Math.min(...ranks) : null;
        }

        // è·å–è¶‹åŠ¿å›¾æ ‡
        function getTrendIcon(trend) {
            const icons = {
                up: '<span class="metric-trend trend-up">â†— ä¸Šå‡</span>',
                down: '<span class="metric-trend trend-down">â†˜ ä¸‹é™</span>',
                stable: '<span class="metric-trend trend-stable">â†’ ç¨³å®š</span>'
            };
            return icons[trend] || icons.stable;
        }

        // è·å–å¾—åˆ†æ ·å¼
        function getScoreClass(score) {
            if (score >= 8) return 'score-high';
            if (score >= 6) return 'score-medium';
            return 'score-low';
        }

        // è·å–åˆ†ç±»åç§°
        function getCategoryName(category) {
            const names = {
                brand: 'å“ç‰Œè¯',
                product: 'äº§å“è¯',
                feature: 'åŠŸèƒ½è¯',
                tutorial: 'æ•™ç¨‹è¯',
                commercial: 'å•†ä¸šè¯',
                general: 'é€šç”¨è¯'
            };
            return names[category] || 'å…¶ä»–';
        }

        // è·å–æ’åå¾½ç« 
        function getRankBadge(rank) {
            if (!rank) return '<span class="rank-badge rank-none">-</span>';
            
            let className = 'rank-none';
            if (rank <= 3) className = 'rank-1-3';
            else if (rank <= 10) className = 'rank-4-10';
            else if (rank <= 20) className = 'rank-11-20';
            else if (rank <= 50) className = 'rank-21-50';
            
            return `<span class="rank-badge ${className}">${rank}</span>`;
        }

        // ç”Ÿæˆä¼˜åŒ–æœºä¼š
        function generateOpportunities() {
            const container = document.getElementById('opportunitiesContainer');
            container.innerHTML = '';
            
            opportunityData.forEach(opp => {
                const card = document.createElement('div');
                card.className = `opportunity-card opportunity-${opp.priority}`;
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <div>
                            <h4 style="margin: 0; font-size: 1.1rem;">${opp.keyword}</h4>
                            <p style="margin: 0.5rem 0; color: #666;">${opp.description}</p>
                        </div>
                        <span class="badge badge-${opp.priority}">${getPriorityName(opp.priority)}</span>
                    </div>
                    
                    <div>
                        <strong>å»ºè®®æ“ä½œï¼š</strong>
                        <ul style="margin: 0.5rem 0;">
                            ${opp.actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // è·å–ä¼˜å…ˆçº§åç§°
        function getPriorityName(priority) {
            const names = {
                urgent: 'ç´§æ€¥',
                high: 'é«˜',
                medium: 'ä¸­',
                low: 'ä½'
            };
            return names[priority] || 'ä¸­';
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æœç´¢åŠŸèƒ½
            document.getElementById('keywordSearch').addEventListener('input', filterTable);
            
            // è¿‡æ»¤æ ‡ç­¾
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                    tab.parentElement.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // æ‰§è¡Œè¿‡æ»¤
                    filterTable();
                });
            });
        }

        // è¿‡æ»¤è¡¨æ ¼
        function filterTable() {
            const searchTerm = document.getElementById('keywordSearch').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-tab.active').dataset.filter;
            
            const tbody = document.getElementById('rankingsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                const keyword = keywordData[index];
                const keywordText = keyword.keyword.toLowerCase();
                
                // æœç´¢è¿‡æ»¤
                const matchesSearch = keywordText.includes(searchTerm);
                
                // åˆ†ç±»è¿‡æ»¤
                let matchesFilter = true;
                if (activeFilter !== 'all') {
                    const bestRank = getBestRank(keyword.rankings);
                    
                    switch (activeFilter) {
                        case 'top10':
                            matchesFilter = bestRank && bestRank <= 10;
                            break;
                        case 'firstPage':
                            matchesFilter = bestRank && bestRank <= 20;
                            break;
                        case 'opportunities':
                            matchesFilter = keyword.opportunities > 0;
                            break;
                        case 'noRank':
                            matchesFilter = !bestRank;
                            break;
                    }
                }
                
                row.style.display = (matchesSearch && matchesFilter) ? '' : 'none';
            });
        }

        // ç³»ç»Ÿæ§åˆ¶å‡½æ•°
        async function startKeywordCollection() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'ğŸ”„ é‡‡é›†ä¸­...';
            button.disabled = true;
            
            // æ¨¡æ‹Ÿé‡‡é›†è¿‡ç¨‹
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                
                // æ›´æ–°çŠ¶æ€
                document.getElementById('collectionStatus').textContent = 'å·²å®Œæˆ';
                document.getElementById('lastCollection').textContent = 'åˆšåˆš';
                
                // æ¨¡æ‹Ÿæ–°å¢å…³é”®è¯
                const newKeywords = Math.floor(Math.random() * 20) + 5;
                keywordData.push(...generateMockKeywords(newKeywords));
                updateMetrics();
                generateRankingsTable();
                
                alert(`âœ… å…³é”®è¯é‡‡é›†å®Œæˆï¼æ–°å¢ ${newKeywords} ä¸ªå…³é”®è¯`);
            }, 3000);
        }

        async function startRankingMonitor() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'ğŸ“Š ç›‘æ§ä¸­...';
            button.disabled = true;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('tableLoading').classList.add('show');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                
                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('tableLoading').classList.remove('show');
                
                // æ›´æ–°çŠ¶æ€
                document.getElementById('monitoringStatus').textContent = 'å·²å®Œæˆ';
                document.getElementById('lastMonitoring').textContent = 'åˆšåˆš';
                
                // æ¨¡æ‹Ÿæ’åå˜åŒ–
                keywordData.forEach(keyword => {
                    Object.keys(keyword.rankings).forEach(engine => {
                        if (keyword.rankings[engine] && Math.random() < 0.3) {
                            const change = Math.floor(Math.random() * 6) - 3; // -3 åˆ° +3
                            keyword.rankings[engine] = Math.max(1, keyword.rankings[engine] + change);
                        }
                    });
                });
                
                updateMetrics();
                generateRankingsTable();
                updateCharts();
                
                alert('âœ… æ’åç›‘æ§å®Œæˆï¼å‘ç°éƒ¨åˆ†æ’åå˜åŒ–');
            }, 4000);
        }

        async function analyzeKeywords() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'ğŸ§  åˆ†æä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                
                // æ›´æ–°çŠ¶æ€
                document.getElementById('analysisStatus').textContent = 'å·²å®Œæˆ';
                document.getElementById('lastAnalysis').textContent = 'åˆšåˆš';
                
                // ç”Ÿæˆæ–°çš„ä¼˜åŒ–æœºä¼š
                const newOpportunities = generateMockOpportunities(3);
                opportunityData.push(...newOpportunities);
                generateOpportunities();
                updateMetrics();
                
                alert(`âœ… æ™ºèƒ½åˆ†æå®Œæˆï¼è¯†åˆ«å‡º ${newOpportunities.length} ä¸ªæ–°çš„ä¼˜åŒ–æœºä¼š`);
            }, 2500);
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿå…³é”®è¯
        function generateMockKeywords(count) {
            const templates = [
                'Telegram ${type}', 'ç”µæŠ¥${type}', 'TG${type}', 
                '${type} Telegram', '${type}ç”µæŠ¥', '${type}TG'
            ];
            const types = ['å·¥å…·', 'æ’ä»¶', 'è„šæœ¬', 'åº”ç”¨', 'è½¯ä»¶', 'å¹³å°'];
            const categories = ['product', 'feature', 'tutorial', 'commercial'];
            
            const newKeywords = [];
            for (let i = 0; i < count; i++) {
                const template = templates[Math.floor(Math.random() * templates.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const keyword = template.replace('${type}', type);
                
                newKeywords.push({
                    keyword,
                    category: categories[Math.floor(Math.random() * categories.length)],
                    score: Math.round((Math.random() * 5 + 4) * 10) / 10,
                    rankings: generateMockRankings(),
                    trend: ['up', 'down', 'stable'][Math.floor(Math.random() * 3)],
                    opportunities: Math.floor(Math.random() * 4)
                });
            }
            
            return newKeywords;
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæ’å
        function generateMockRankings() {
            const rankings = {};
            const engines = ['baidu', 'google', 'bing', 'so360'];
            
            engines.forEach(engine => {
                if (Math.random() < 0.7) { // 70%æ¦‚ç‡æœ‰æ’å
                    rankings[engine] = Math.floor(Math.random() * 50) + 1;
                } else {
                    rankings[engine] = null;
                }
            });
            
            return rankings;
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæœºä¼š
        function generateMockOpportunities(count) {
            const types = ['breakthrough_potential', 'first_page', 'new_opportunity'];
            const priorities = ['high', 'medium', 'urgent'];
            const descriptions = [
                'æ¥è¿‘é¦–é¡µçªç ´ï¼ŒçŸ­æœŸå¯è§æ•ˆ',
                'é«˜ä»·å€¼å…³é”®è¯è¡¨ç°ä¸ä½³',
                'æ–°å…´å…³é”®è¯æœºä¼š',
                'ç«äº‰å¯¹æ‰‹æ’åè¾ƒå¼±'
            ];
            
            const opportunities = [];
            for (let i = 0; i < count; i++) {
                opportunities.push({
                    keyword: `æ–°æœºä¼šå…³é”®è¯${i + 1}`,
                    type: types[Math.floor(Math.random() * types.length)],
                    priority: priorities[Math.floor(Math.random() * priorities.length)],
                    description: descriptions[Math.floor(Math.random() * descriptions.length)],
                    actions: ['ä¼˜åŒ–å†…å®¹', 'å¢åŠ å†…é“¾', 'æå‡æƒé‡']
                });
            }
            
            return opportunities;
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            if (charts.rankingTrend) {
                // æ›´æ–°è¶‹åŠ¿å›¾æ•°æ®
                const newAvgRanking = calculateAverageRanking();
                const newTop10Count = countRankingsByRange(1, 10);
                
                charts.rankingTrend.data.datasets[0].data.push(newAvgRanking);
                charts.rankingTrend.data.datasets[1].data.push(newTop10Count);
                charts.rankingTrend.data.labels.push('ä»Šå¤©');
                
                // ä¿æŒæ•°æ®ç‚¹æ•°é‡
                if (charts.rankingTrend.data.labels.length > 31) {
                    charts.rankingTrend.data.labels.shift();
                    charts.rankingTrend.data.datasets[0].data.shift();
                    charts.rankingTrend.data.datasets[1].data.shift();
                }
                
                charts.rankingTrend.update();
            }
            
            // æ›´æ–°åˆ†å¸ƒå›¾
            if (charts.engineDist) {
                const engineStats = calculateEngineStats();
                charts.engineDist.data.datasets[0].data = [
                    engineStats.baidu, engineStats.google, 
                    engineStats.bing, engineStats.so360
                ];
                charts.engineDist.update();
            }
            
            if (charts.rankingDist) {
                const rankingDist = calculateRankingDistribution();
                charts.rankingDist.data.datasets[0].data = [
                    rankingDist.top3, rankingDist.top10, rankingDist.top20,
                    rankingDist.top50, rankingDist.beyond50
                ];
                charts.rankingDist.update();
            }
        }

        // å®æ—¶æ•°æ®æ›´æ–°
        function updateRealTimeData() {
            // æ¨¡æ‹Ÿå®æ—¶æ’åå˜åŒ–
            if (Math.random() < 0.1) { // 10%æ¦‚ç‡æœ‰å˜åŒ–
                const randomKeyword = keywordData[Math.floor(Math.random() * keywordData.length)];
                const engines = Object.keys(randomKeyword.rankings);
                const randomEngine = engines[Math.floor(Math.random() * engines.length)];
                
                if (randomKeyword.rankings[randomEngine]) {
                    const change = Math.floor(Math.random() * 4) - 2; // -2 åˆ° +2
                    randomKeyword.rankings[randomEngine] = Math.max(1, 
                        Math.min(100, randomKeyword.rankings[randomEngine] + change));
                    
                    // æ›´æ–°è¡¨æ ¼ä¸­å¯¹åº”è¡Œ
                    generateRankingsTable();
                    updateMetrics();
                }
            }
            
            // æ›´æ–°æ—¶é—´æˆ³
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN');
            document.querySelectorAll('.metric-trend').forEach(el => {
                if (el.textContent.includes('åˆ†é’Ÿå‰')) {
                    const minutes = Math.floor(Math.random() * 30) + 1;
                    el.textContent = `${minutes}åˆ†é’Ÿå‰`;
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        console.log('ğŸ“Š å…³é”®è¯æ’åç›‘æ§é¢æ¿å·²åŠ è½½');
        console.log('ğŸ¯ ç³»ç»Ÿæ­£åœ¨24å°æ—¶è‡ªåŠ¨ç›‘æ§ä¸­');
    </script>
</body>
</html> 